# 数据库表草案（待落 Prisma）

> 来源：原 `README.md` 末尾的零散说明。
>
> 说明：以下仅是“字段草案/需求草稿”，未必已在 `prisma/schema.prisma` 中实现。建议后续以 Prisma 模型为准，并在实现后补充：字段类型、索引、外键、枚举值、默认值。

## 售后表（after_sale）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 订单id | 关联订单 |
| 售后单号 | 售后单唯一编号 |
| 订单商品id | 关联订单商品明细 |
| 售后类型 | 退货 / 换货 / 维修 |
| 售后状态 | 申请中 / 已同意 / 已拒绝 / 已寄回 / 已寄出 / 已完成 |
| 创建者id | 创建该记录的管理员 id |

## 身份-权限关联表（role_permission）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 身份id | 角色/身份 id |
| 权限id | 权限 id |
| 分配者id | 分配该权限的管理员 id |
| 分配时间 | 授权时间 |
| 状态 | 启用 / 禁用 |

## 权限表（permission）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 权限名称 | 例如：商品管理-查询、商品管理-新增、商品管理-编辑、商品管理-删除、订单管理-核销 等 |
| 权限类型 | 例如：菜单/接口/按钮（按项目约定） |
| 父级权限id | 用于权限树：如“商品管理”为“商品管理-查询”的父级 |
| 模块名称 | 权限所属模块 |
| 状态 | 启用 / 禁用 |

## 系统全局消息表（system_message_global）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 发送者id | 管理员 id |
| 通知类型 | 公告 / 提醒 / 活动 / 通知 |
| 标题 | 标题 |
| 内容 | 内容 |
| 发送时间 | 创建/发送时间 |
| 生效时间 | 支持定时推送 |
| 过期时间 | 过期后自动隐藏 |
| 状态 | 正常 / 撤回 / 下架 |

## 个人通知消息表（system_message_personal）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 发送者id | 管理员 id |
| 通知类型 | 公告 / 提醒 / 活动 / 通知 |
| 标题 | 标题 |
| 内容 | 内容 |
| 发送时间 | 创建/发送时间 |
| 生效时间 | 支持定时推送 |
| 过期时间 | 过期后自动隐藏 |
| 状态 | 正常 / 撤回 / 下架 |

## 用户-系统通知表（user_message）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 用户id | 用户 id |
| 消息类型 | 个人 / 全局 |
| 个人通知id | 关联个人通知 |
| 全局通知id | 关联全局通知 |
| 通知时间 | 个人：推送时间 / 全局：用户首次查看时间（草案原文如此，建议拆分字段更清晰） |
| 已读 | bool |
| 已读时间 | 已读时间 |
| 是否删除 | bool |

## 用户-客服对话新消息通知表（chat_message_notice）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 用户id | 用户 id |
| 会话室id | 会话室 id |
| 关联消息id | 关联消息表主键 |
| 通知对象类型 | 用户 / 管理员 |
| 对象id | 用户id / 管理员id |
| 回复源消息id | 被回复的源消息 id |
| 删除 | bool |
| 删除时间 | 删除时间 |
| 通知时间 | 通知时间 |
| 状态 | 已读 / 未读 |

## 用户-客服对话窗口列表（chat_window）

> 原草案未给 id 字段，这里保留原意：以（用户id + 会话室id）或独立 id 建模均可。

| 字段 | 说明 |
|---|---|
| 用户id | 用户 id |
| 会话室id | 会话室 id |
| 管理员id | 客服管理员 id |
| 用户删除 | bool |
| 用户删除时间 | datetime |
| 管理员删除 | bool |
| 管理员删除时间 | datetime |

## 客服-用户会话室（chat_room）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 用户id | 用户 id |
| 管理员id | 客服身份的管理员 id |
| 用户未读消息数量 | number |
| 管理员未读消息数量 | number |
| 会话创建时间 | datetime |
| 结束时间 | datetime |
| 状态 | 已结束 / 进行中 |

## 客服-用户会话室-消息表（chat_room_message）

| 字段 | 说明 |
|---|---|
| 消息主键id | 主键 |
| 会话室id | chat_room id |
| 发送者身份 | 用户 / 管理员 |
| 发送者id | 用户id / 管理员id |
| 接收者身份 | 用户 / 管理员 |
| 接收者id | 用户id / 管理员id |
| 接收者已读 | bool |
| 已读时间 | datetime |
| 消息内容 | text |
| 发送时间 | datetime |
| 状态 | 撤回 / 正常（两分钟内可撤回） |
| 撤回时间 | datetime |
| 被回复信息id | 被回复的消息 id |
| 回复层级数 | number |

## 用户-客服评价表（chat_rating）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 用户id | 用户 id |
| 会话室id | chat_room id |
| 客服id | 管理员 id |
| 评价内容 | text |
| 评价星星数 | 1~5，可 0.5 为单位 |
| 添加时间 | datetime |
| 更新时间 | datetime |
| 状态 | 撤回 / 正常 |
| 撤回原因 | text |

## 客服指标表（customer_service_metrics）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 客服id | 管理员 id |
| 会话数 | number |
| 已评价会话数 | number |
| 平均星星数 | number |
| 好评数 | 4 分以上 |
| 好评率 | 好评数 / 评价会话数 |
| 统计时间 | datetime |

## 管理员 Session 表（admin_session）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 管理员id | 管理员 id |
| session唯一标识符 | session key |
| 存储的管理员信息 | json |
| 过期时间 | datetime |
| 创建时间 | datetime |
| 修改时间 | datetime |

## 管理员登录表（admin_login_log）

| 字段 | 说明 |
|---|---|
| id | 主键 |
| 管理员id | 管理员 id |
| session id | session 关联 |
| 设备名称 | 设备名 |
| 设备类型 | 手机 / 电脑 |
| 登陆时间 | datetime |
| 登陆ip | ip |
| 登出时间 | datetime |
| session过期时间 | datetime |
